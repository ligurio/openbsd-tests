#!/bin/sh

# Setup OpenBSD

VERSION="54"

if [ -n $PKG_PATH ]; then
        MIRROR=$(grep ^installpath /etc/pkg.conf | sed 's/packages\///g' | awk '{ print $3 }')
else
        MIRROR="ftp://ftp.eu.openbsd.org/pub/OpenBSD/snapshots/$(uname -m)"
fi

in_linux ()
{
	curl ftp://ftp.eu.openbsd.org/pub/OpenBSD/snapshots/amd64/cd$VERSION.iso > /boot/cd$VERSION.iso
	yum install syslinux
	cp /usr/share/syslinux/memdisk /boot/
		
	cat > /boot/grub/grub.cfg << "EOF"
	set default=0
	set timeout=5
	title "OpenBSD  installation"
		kernel /memdisk iso
		initrd /cd$VERSION.iso
	EOF
}

in_openbsd ()
{
	ftp $MIRROR/bsd.rd -o /bsd.rd
	echo "boot bsd.rd" > /etc/boot.conf && reboot
}

if [ `uname` -eq "Linux" ]; then
	in_linux();
elif [ `uname` -eq "OpenBSD" ]; then
	in_openbsd();
else
	echo "No support"
fi
