<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - 6.4 - ufs/ext2fs/ext2fs.h</title>
  <link rel="stylesheet" type="text/css" href="../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../index.html">top level</a> - <a href="index.html">ufs/ext2fs</a> - ext2fs.h<span style="font-size: 80%;"> (source / <a href="ext2fs.h.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">6.4</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">12</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2018-10-19 03:25:38</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">2</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Legend:</td>
            <td class="headerValueLeg">            Lines:
            <span class="coverLegendCov">hit</span>
            <span class="coverLegendNoCov">not hit</span>
</td>
            <td></td>
          </tr>
          <tr><td><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /*      $OpenBSD: ext2fs.h,v 1.23 2016/04/27 11:27:24 krw Exp $ */</a>
<span class="lineNum">       2 </span>            : /*      $NetBSD: ext2fs.h,v 1.10 2000/01/28 16:00:23 bouyer Exp $       */
<span class="lineNum">       3 </span>            : 
<span class="lineNum">       4 </span>            : /*
<span class="lineNum">       5 </span>            :  * Copyright (c) 1997 Manuel Bouyer.
<span class="lineNum">       6 </span>            :  * Copyright (c) 1982, 1986, 1993
<span class="lineNum">       7 </span>            :  *      The Regents of the University of California.  All rights reserved.
<span class="lineNum">       8 </span>            :  *
<span class="lineNum">       9 </span>            :  * Redistribution and use in source and binary forms, with or without
<span class="lineNum">      10 </span>            :  * modification, are permitted provided that the following conditions
<span class="lineNum">      11 </span>            :  * are met:
<span class="lineNum">      12 </span>            :  * 1. Redistributions of source code must retain the above copyright
<span class="lineNum">      13 </span>            :  *    notice, this list of conditions and the following disclaimer.
<span class="lineNum">      14 </span>            :  * 2. Redistributions in binary form must reproduce the above copyright
<span class="lineNum">      15 </span>            :  *    notice, this list of conditions and the following disclaimer in the
<span class="lineNum">      16 </span>            :  *    documentation and/or other materials provided with the distribution.
<span class="lineNum">      17 </span>            :  * 3. Neither the name of the University nor the names of its contributors
<span class="lineNum">      18 </span>            :  *    may be used to endorse or promote products derived from this software
<span class="lineNum">      19 </span>            :  *    without specific prior written permission.
<span class="lineNum">      20 </span>            :  *
<span class="lineNum">      21 </span>            :  * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
<span class="lineNum">      22 </span>            :  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
<span class="lineNum">      23 </span>            :  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
<span class="lineNum">      24 </span>            :  * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
<span class="lineNum">      25 </span>            :  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
<span class="lineNum">      26 </span>            :  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
<span class="lineNum">      27 </span>            :  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
<span class="lineNum">      28 </span>            :  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
<span class="lineNum">      29 </span>            :  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
<span class="lineNum">      30 </span>            :  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
<span class="lineNum">      31 </span>            :  * SUCH DAMAGE.
<span class="lineNum">      32 </span>            :  *
<span class="lineNum">      33 </span>            :  *      @(#)fs.h        8.10 (Berkeley) 10/27/94
<span class="lineNum">      34 </span>            :  *  Modified for ext2fs by Manuel Bouyer.
<span class="lineNum">      35 </span>            :  */
<span class="lineNum">      36 </span>            : 
<span class="lineNum">      37 </span>            : #include &lt;sys/endian.h&gt;
<span class="lineNum">      38 </span>            : 
<span class="lineNum">      39 </span>            : /*
<span class="lineNum">      40 </span>            :  * Each disk drive contains some number of file systems.
<span class="lineNum">      41 </span>            :  * A file system consists of a number of cylinder groups.
<span class="lineNum">      42 </span>            :  * Each cylinder group has inodes and data.
<span class="lineNum">      43 </span>            :  *
<span class="lineNum">      44 </span>            :  * A file system is described by its super-block, which in turn
<span class="lineNum">      45 </span>            :  * describes the cylinder groups.  The super-block is critical
<span class="lineNum">      46 </span>            :  * data and is replicated in each cylinder group to protect against
<span class="lineNum">      47 </span>            :  * catastrophic loss.  This is done at `newfs' time and the critical
<span class="lineNum">      48 </span>            :  * super-block data does not change, so the copies need not be
<span class="lineNum">      49 </span>            :  * referenced further unless disaster strikes.
<span class="lineNum">      50 </span>            :  *
<span class="lineNum">      51 </span>            :  * The first boot and super blocks are given in absolute disk addresses.
<span class="lineNum">      52 </span>            :  * The byte-offset forms are preferred, as they don't imply a sector size.
<span class="lineNum">      53 </span>            :  */
<span class="lineNum">      54 </span>            : #define BBSIZE          1024
<span class="lineNum">      55 </span>            : #define SBSIZE          1024
<span class="lineNum">      56 </span>            : #define BBOFF           ((off_t)(0))
<span class="lineNum">      57 </span>            : #define SBOFF           ((off_t)(BBOFF + BBSIZE))
<span class="lineNum">      58 </span>            : #define BBLOCK          ((daddr_t)(0))
<span class="lineNum">      59 </span>            : #define SBLOCK          ((daddr_t)(BBLOCK + BBSIZE / DEV_BSIZE))
<span class="lineNum">      60 </span>            : 
<span class="lineNum">      61 </span>            : /*
<span class="lineNum">      62 </span>            :  * Inodes are, like in UFS, 32-bit unsigned integers and therefore ufsino_t.
<span class="lineNum">      63 </span>            :  * Disk blocks are 32-bit, if the filesystem isn't operating in 64-bit mode
<span class="lineNum">      64 </span>            :  * (the incompatible ext4 64BIT flag).  More work is needed to properly use
<span class="lineNum">      65 </span>            :  * daddr_t as the disk block data type on both BE and LE architectures.
<span class="lineNum">      66 </span>            :  * XXX disk blocks are simply u_int32_t for now.
<span class="lineNum">      67 </span>            :  */
<span class="lineNum">      68 </span>            : 
<span class="lineNum">      69 </span>            : /*
<span class="lineNum">      70 </span>            :  * MINBSIZE is the smallest allowable block size.
<span class="lineNum">      71 </span>            :  * MINBSIZE must be big enough to hold a cylinder group block,
<span class="lineNum">      72 </span>            :  * thus changes to (struct cg) must keep its size within MINBSIZE.
<span class="lineNum">      73 </span>            :  * Note that super blocks are always of size SBSIZE,
<span class="lineNum">      74 </span>            :  * and that both SBSIZE and MAXBSIZE must be &gt;= MINBSIZE.
<span class="lineNum">      75 </span>            :  * FSIZE means fragment size.
<span class="lineNum">      76 </span>            :  */
<span class="lineNum">      77 </span>            : #define LOG_MINBSIZE    10
<span class="lineNum">      78 </span>            : #define MINBSIZE        (1 &lt;&lt; LOG_MINBSIZE)
<span class="lineNum">      79 </span>            : #define LOG_MINFSIZE    10
<span class="lineNum">      80 </span>            : #define MINFSIZE        (1 &lt;&lt; LOG_MINFSIZE)
<span class="lineNum">      81 </span>            : 
<span class="lineNum">      82 </span>            : /*
<span class="lineNum">      83 </span>            :  * The path name on which the file system is mounted is maintained
<span class="lineNum">      84 </span>            :  * in fs_fsmnt. MAXMNTLEN defines the amount of space allocated in
<span class="lineNum">      85 </span>            :  * the super block for this name.
<span class="lineNum">      86 </span>            :  */
<span class="lineNum">      87 </span>            : #define MAXMNTLEN       512
<span class="lineNum">      88 </span>            : 
<span class="lineNum">      89 </span>            : /*
<span class="lineNum">      90 </span>            :  * MINFREE gives the minimum acceptable percentage of file system
<span class="lineNum">      91 </span>            :  * blocks which may be free. If the freelist drops below this level
<span class="lineNum">      92 </span>            :  * only the superuser may continue to allocate blocks. This may
<span class="lineNum">      93 </span>            :  * be set to 0 if no reserve of free blocks is deemed necessary,
<span class="lineNum">      94 </span>            :  * however throughput drops by fifty percent if the file system
<span class="lineNum">      95 </span>            :  * is run at between 95% and 100% full; thus the minimum default
<span class="lineNum">      96 </span>            :  * value of fs_minfree is 5%. However, to get good clustering
<span class="lineNum">      97 </span>            :  * performance, 10% is a better choice. hence we use 10% as our
<span class="lineNum">      98 </span>            :  * default value. With 10% free space, fragmentation is not a
<span class="lineNum">      99 </span>            :  * problem, so we choose to optimize for time.
<span class="lineNum">     100 </span>            :  */
<span class="lineNum">     101 </span>            : #define MINFREE         5
<span class="lineNum">     102 </span>            : 
<span class="lineNum">     103 </span>            : /*
<span class="lineNum">     104 </span>            :  * Super block for an ext2fs file system.
<span class="lineNum">     105 </span>            :  */
<span class="lineNum">     106 </span>            : struct ext2fs {
<span class="lineNum">     107 </span>            :         u_int32_t  e2fs_icount;         /* Inode count */
<span class="lineNum">     108 </span>            :         u_int32_t  e2fs_bcount;         /* blocks count */
<span class="lineNum">     109 </span>            :         u_int32_t  e2fs_rbcount;        /* reserved blocks count */
<span class="lineNum">     110 </span>            :         u_int32_t  e2fs_fbcount;        /* free blocks count */
<span class="lineNum">     111 </span>            :         u_int32_t  e2fs_ficount;        /* free inodes count */
<span class="lineNum">     112 </span>            :         u_int32_t  e2fs_first_dblock;   /* first data block */
<span class="lineNum">     113 </span>            :         u_int32_t  e2fs_log_bsize;      /* block size = 1024*(2^e2fs_log_bsize) */
<span class="lineNum">     114 </span>            :         u_int32_t  e2fs_log_fsize;      /* fragment size log2 */
<span class="lineNum">     115 </span>            :         u_int32_t  e2fs_bpg;            /* blocks per group */
<span class="lineNum">     116 </span>            :         u_int32_t  e2fs_fpg;            /* frags per group */
<span class="lineNum">     117 </span>            :         u_int32_t  e2fs_ipg;            /* inodes per group */
<span class="lineNum">     118 </span>            :         u_int32_t  e2fs_mtime;          /* mount time */
<span class="lineNum">     119 </span>            :         u_int32_t  e2fs_wtime;          /* write time */
<span class="lineNum">     120 </span>            :         u_int16_t  e2fs_mnt_count;      /* mount count */
<span class="lineNum">     121 </span>            :         u_int16_t  e2fs_max_mnt_count;  /* max mount count */
<span class="lineNum">     122 </span>            :         u_int16_t  e2fs_magic;          /* magic number */
<span class="lineNum">     123 </span>            :         u_int16_t  e2fs_state;          /* file system state */
<span class="lineNum">     124 </span>            :         u_int16_t  e2fs_beh;            /* behavior on errors */
<span class="lineNum">     125 </span>            :         u_int16_t  e2fs_minrev;         /* minor revision level */
<span class="lineNum">     126 </span>            :         u_int32_t  e2fs_lastfsck;       /* time of last fsck */
<span class="lineNum">     127 </span>            :         u_int32_t  e2fs_fsckintv;       /* max time between fscks */
<span class="lineNum">     128 </span>            :         u_int32_t  e2fs_creator;        /* creator OS */
<span class="lineNum">     129 </span>            :         u_int32_t  e2fs_rev;            /* revision level */
<span class="lineNum">     130 </span>            :         u_int16_t  e2fs_ruid;           /* default uid for reserved blocks */
<span class="lineNum">     131 </span>            :         u_int16_t  e2fs_rgid;           /* default gid for reserved blocks */
<span class="lineNum">     132 </span>            :         /* EXT2_DYNAMIC_REV superblocks */
<span class="lineNum">     133 </span>            :         u_int32_t  e2fs_first_ino;      /* first non-reserved inode */
<span class="lineNum">     134 </span>            :         u_int16_t  e2fs_inode_size;     /* size of inode structure */
<span class="lineNum">     135 </span>            :         u_int16_t  e2fs_block_group_nr; /* block grp number of this sblk*/
<span class="lineNum">     136 </span>            :         u_int32_t  e2fs_features_compat; /*  compatible feature set */
<span class="lineNum">     137 </span>            :         u_int32_t  e2fs_features_incompat; /* incompatible feature set */
<span class="lineNum">     138 </span>            :         u_int32_t  e2fs_features_rocompat; /* RO-compatible feature set */
<span class="lineNum">     139 </span>            :         u_int8_t   e2fs_uuid[16];       /* 128-bit uuid for volume */
<span class="lineNum">     140 </span>            :         char       e2fs_vname[16];      /* volume name */
<span class="lineNum">     141 </span>            :         char       e2fs_fsmnt[64];      /* name mounted on */
<span class="lineNum">     142 </span>            :         u_int32_t  e2fs_algo;           /* For compression */
<span class="lineNum">     143 </span>            :         u_int8_t   e2fs_prealloc;       /* # of blocks to preallocate */
<span class="lineNum">     144 </span>            :         u_int8_t   e2fs_dir_prealloc;   /* # of blocks to preallocate for dir */
<span class="lineNum">     145 </span>            :         u_int16_t  e2fs_reserved_ngdb;  /* # of reserved gd blocks for resize */
<span class="lineNum">     146 </span>            :         /* Ext3 JBD2 journaling. */
<span class="lineNum">     147 </span>            :         u_int8_t   e2fs_journal_uuid[16];
<span class="lineNum">     148 </span>            :         u_int32_t  e2fs_journal_ino;
<span class="lineNum">     149 </span>            :         u_int32_t  e2fs_journal_dev;
<span class="lineNum">     150 </span>            :         u_int32_t  e2fs_last_orphan;    /* start of list of inodes to delete */
<span class="lineNum">     151 </span>            :         u_int32_t  e2fs_hash_seed[4];   /* htree hash seed */
<span class="lineNum">     152 </span>            :         u_int8_t   e2fs_def_hash_version;
<span class="lineNum">     153 </span>            :         u_int8_t   e2fs_journal_backup_type;
<span class="lineNum">     154 </span>            :         u_int16_t  e2fs_gdesc_size;
<span class="lineNum">     155 </span>            :         u_int32_t  e2fs_default_mount_opts;
<span class="lineNum">     156 </span>            :         u_int32_t  e2fs_first_meta_bg;
<span class="lineNum">     157 </span>            :         u_int32_t  e2fs_mkfs_time;
<span class="lineNum">     158 </span>            :         u_int32_t  e2fs_journal_backup[17];
<span class="lineNum">     159 </span>            :         u_int32_t  reserved2[172];
<span class="lineNum">     160 </span>            : };
<span class="lineNum">     161 </span>            : 
<span class="lineNum">     162 </span>            : 
<span class="lineNum">     163 </span>            : /* in-memory data for ext2fs */
<span class="lineNum">     164 </span>            : struct m_ext2fs {
<span class="lineNum">     165 </span>            :         struct ext2fs e2fs;
<span class="lineNum">     166 </span>            :         u_char  e2fs_fsmnt[MAXMNTLEN];  /* name mounted on */
<span class="lineNum">     167 </span>            :         int8_t  e2fs_ronly;     /* mounted read-only flag */
<span class="lineNum">     168 </span>            :         int8_t  e2fs_fmod;      /* super block modified flag */
<span class="lineNum">     169 </span>            :         int32_t e2fs_fsize;     /* fragment size */
<span class="lineNum">     170 </span>            :         int32_t e2fs_bsize;     /* block size */
<span class="lineNum">     171 </span>            :         int32_t e2fs_bshift;    /* ``lblkno'' calc of logical blkno */
<span class="lineNum">     172 </span>            :         int32_t e2fs_bmask;     /* ``blkoff'' calc of blk offsets */
<span class="lineNum">     173 </span>            :         int64_t e2fs_qbmask;    /* ~fs_bmask - for use with quad size */
<span class="lineNum">     174 </span>            :         int32_t e2fs_fsbtodb;   /* fsbtodb and dbtofsb shift constant */
<span class="lineNum">     175 </span>            :         int32_t e2fs_ncg;       /* number of cylinder groups */
<span class="lineNum">     176 </span>            :         int32_t e2fs_ngdb;      /* number of group descriptor block */
<span class="lineNum">     177 </span>            :         int32_t e2fs_ipb;       /* number of inodes per block */
<span class="lineNum">     178 </span>            :         int32_t e2fs_itpg;      /* number of inode table per group */
<span class="lineNum">     179 </span>            :         off_t   e2fs_maxfilesize;       /* depends on LARGE/HUGE flags */
<span class="lineNum">     180 </span>            :         struct  ext2_gd *e2fs_gd; /* group descriptors */
<span class="lineNum">     181 </span>            : };
<a name="182"><span class="lineNum">     182 </span>            : </a>
<span class="lineNum">     183 </span>            : static inline int
<span class="lineNum">     184 </span><span class="lineNoCov">          0 : e2fs_overflow(struct m_ext2fs *fs, off_t lower, off_t value)</span>
<span class="lineNum">     185 </span>            : {
<span class="lineNum">     186 </span><span class="lineNoCov">          0 :         return (value &lt; lower || value &gt; fs-&gt;e2fs_maxfilesize);</span>
<span class="lineNum">     187 </span>            : }
<span class="lineNum">     188 </span>            : 
<span class="lineNum">     189 </span>            : /*
<span class="lineNum">     190 </span>            :  * Filesystem identification
<span class="lineNum">     191 </span>            :  */
<span class="lineNum">     192 </span>            : #define E2FS_MAGIC      0xef53  /* the ext2fs magic number */
<span class="lineNum">     193 </span>            : #define E2FS_REV0       0       /* revision levels */
<span class="lineNum">     194 </span>            : #define E2FS_REV1       1       /* revision levels */
<span class="lineNum">     195 </span>            : 
<span class="lineNum">     196 </span>            : /* compatible/imcompatible features */
<span class="lineNum">     197 </span>            : #define EXT2F_COMPAT_PREALLOC           0x0001
<span class="lineNum">     198 </span>            : #define EXT2F_COMPAT_HASJOURNAL         0x0004
<span class="lineNum">     199 </span>            : #define EXT2F_COMPAT_RESIZE             0x0010
<span class="lineNum">     200 </span>            : #define EXT2F_COMPAT_DIRHASHINDEX       0x0020
<span class="lineNum">     201 </span>            : 
<span class="lineNum">     202 </span>            : 
<span class="lineNum">     203 </span>            : #define EXT2F_ROCOMPAT_SPARSESUPER      0x0001
<span class="lineNum">     204 </span>            : #define EXT2F_ROCOMPAT_LARGEFILE        0x0002
<span class="lineNum">     205 </span>            : #define EXT2F_ROCOMPAT_BTREE_DIR        0x0004
<span class="lineNum">     206 </span>            : #define EXT2F_ROCOMPAT_HUGE_FILE        0x0008
<span class="lineNum">     207 </span>            : 
<span class="lineNum">     208 </span>            : #define EXT2F_INCOMPAT_COMP             0x0001
<span class="lineNum">     209 </span>            : #define EXT2F_INCOMPAT_FTYPE            0x0002
<span class="lineNum">     210 </span>            : #define EXT2F_INCOMPAT_RECOVER          0x0004
<span class="lineNum">     211 </span>            : #define EXT2F_INCOMPAT_JOURNAL_DEV      0x0008
<span class="lineNum">     212 </span>            : #define EXT2F_INCOMPAT_META_BG          0x0010
<span class="lineNum">     213 </span>            : #define EXT2F_INCOMPAT_EXTENTS          0x0040
<span class="lineNum">     214 </span>            : #define EXT2F_INCOMPAT_FLEX_BG          0x0200
<span class="lineNum">     215 </span>            : 
<span class="lineNum">     216 </span>            : /* features supported in this implementation */
<span class="lineNum">     217 </span>            : #define EXT2F_COMPAT_SUPP               0x0000
<span class="lineNum">     218 </span>            : #define EXT2F_ROCOMPAT_SUPP             (EXT2F_ROCOMPAT_SPARSESUPER | \
<span class="lineNum">     219 </span>            :                                          EXT2F_ROCOMPAT_LARGEFILE)
<span class="lineNum">     220 </span>            : #define EXT2F_INCOMPAT_SUPP             (EXT2F_INCOMPAT_FTYPE)
<span class="lineNum">     221 </span>            : #define EXT4F_RO_INCOMPAT_SUPP          (EXT2F_INCOMPAT_EXTENTS | \
<span class="lineNum">     222 </span>            :                                          EXT2F_INCOMPAT_FLEX_BG | \
<span class="lineNum">     223 </span>            :                                          EXT2F_INCOMPAT_META_BG | \
<span class="lineNum">     224 </span>            :                                          EXT2F_INCOMPAT_RECOVER)
<span class="lineNum">     225 </span>            : 
<span class="lineNum">     226 </span>            : /*
<span class="lineNum">     227 </span>            :  * Definitions of behavior on errors
<span class="lineNum">     228 </span>            :  */
<span class="lineNum">     229 </span>            : #define E2FS_BEH_CONTINUE       1       /* continue operation */
<span class="lineNum">     230 </span>            : #define E2FS_BEH_READONLY       2       /* remount fs read only */
<span class="lineNum">     231 </span>            : #define E2FS_BEH_PANIC          3       /* cause panic */
<span class="lineNum">     232 </span>            : #define E2FS_BEH_DEFAULT        E2FS_BEH_CONTINUE
<span class="lineNum">     233 </span>            : 
<span class="lineNum">     234 </span>            : /*
<span class="lineNum">     235 </span>            :  * OS identification
<span class="lineNum">     236 </span>            :  */
<span class="lineNum">     237 </span>            : #define E2FS_OS_LINUX 0
<span class="lineNum">     238 </span>            : #define E2FS_OS_HURD  1
<span class="lineNum">     239 </span>            : #define E2FS_OS_MASIX 2
<span class="lineNum">     240 </span>            : 
<span class="lineNum">     241 </span>            : /*
<span class="lineNum">     242 </span>            :  * Filesystem clean flags
<span class="lineNum">     243 </span>            :  */
<span class="lineNum">     244 </span>            : #define E2FS_ISCLEAN    0x01
<span class="lineNum">     245 </span>            : #define E2FS_ERRORS     0x02
<span class="lineNum">     246 </span>            : 
<span class="lineNum">     247 </span>            : /* ext2 file system block group descriptor */
<span class="lineNum">     248 </span>            : 
<span class="lineNum">     249 </span>            : struct ext2_gd {
<span class="lineNum">     250 </span>            :         u_int32_t ext2bgd_b_bitmap;     /* blocks bitmap block */
<span class="lineNum">     251 </span>            :         u_int32_t ext2bgd_i_bitmap;     /* inodes bitmap block */
<span class="lineNum">     252 </span>            :         u_int32_t ext2bgd_i_tables;     /* inodes table block  */
<span class="lineNum">     253 </span>            :         u_int16_t ext2bgd_nbfree;       /* number of free blocks */
<span class="lineNum">     254 </span>            :         u_int16_t ext2bgd_nifree;       /* number of free inodes */
<span class="lineNum">     255 </span>            :         u_int16_t ext2bgd_ndirs;        /* number of directories */
<span class="lineNum">     256 </span>            :         u_int16_t reserved;
<span class="lineNum">     257 </span>            :         u_int32_t reserved2[3];
<span class="lineNum">     258 </span>            : };
<span class="lineNum">     259 </span>            : 
<span class="lineNum">     260 </span>            : /*
<span class="lineNum">     261 </span>            :  * If the EXT2F_ROCOMPAT_SPARSESUPER flag is set, the cylinder group has a
<span class="lineNum">     262 </span>            :  * copy of the super and cylinder group descriptors blocks only if it's
<span class="lineNum">     263 </span>            :  * a power of 3, 5 or 7
<span class="lineNum">     264 </span>            :  */
<span class="lineNum">     265 </span>            : 
<a name="266"><span class="lineNum">     266 </span>            : static __inline__ int cg_has_sb(int) __attribute__((__unused__));</a>
<span class="lineNum">     267 </span>            : static __inline int
<span class="lineNum">     268 </span><span class="lineNoCov">          0 : cg_has_sb(i)</span>
<span class="lineNum">     269 </span>            :         int i;
<span class="lineNum">     270 </span>            : {
<span class="lineNum">     271 </span>            :         int a3 ,a5 , a7;
<span class="lineNum">     272 </span>            : 
<span class="lineNum">     273 </span><span class="lineNoCov">          0 :         if (i == 0 || i == 1)</span>
<span class="lineNum">     274 </span><span class="lineNoCov">          0 :                 return 1;</span>
<span class="lineNum">     275 </span><span class="lineNoCov">          0 :         for (a3 = 3, a5 = 5, a7 = 7;</span>
<span class="lineNum">     276 </span><span class="lineNoCov">          0 :             a3 &lt;= i || a5 &lt;= i || a7 &lt;= i;</span>
<span class="lineNum">     277 </span><span class="lineNoCov">          0 :             a3 *= 3, a5 *= 5, a7 *= 7)</span>
<span class="lineNum">     278 </span><span class="lineNoCov">          0 :                 if (i == a3 || i == a5 || i == a7)</span>
<span class="lineNum">     279 </span><span class="lineNoCov">          0 :                         return 1;</span>
<span class="lineNum">     280 </span><span class="lineNoCov">          0 :         return 0;</span>
<span class="lineNum">     281 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     282 </span>            : 
<span class="lineNum">     283 </span>            : /*
<span class="lineNum">     284 </span>            :  * Ext2 metadata is stored in little-endian byte order.
<span class="lineNum">     285 </span>            :  * JBD2 journal used in ext3 and ext4 is big-endian!
<span class="lineNum">     286 </span>            :  */
<span class="lineNum">     287 </span>            : #if BYTE_ORDER == LITTLE_ENDIAN
<span class="lineNum">     288 </span>            : #define e2fs_sbload(old, new) memcpy((new), (old), SBSIZE);
<span class="lineNum">     289 </span>            : #define e2fs_cgload(old, new, size) memcpy((new), (old), (size));
<span class="lineNum">     290 </span>            : #define e2fs_sbsave(old, new) memcpy((new), (old), SBSIZE);
<span class="lineNum">     291 </span>            : #define e2fs_cgsave(old, new, size) memcpy((new), (old), (size));
<span class="lineNum">     292 </span>            : #else
<span class="lineNum">     293 </span>            : void e2fs_sb_bswap(struct ext2fs *, struct ext2fs *);
<span class="lineNum">     294 </span>            : void e2fs_cg_bswap(struct ext2_gd *, struct ext2_gd *, int);
<span class="lineNum">     295 </span>            : #define e2fs_sbload(old, new) e2fs_sb_bswap((old), (new))
<span class="lineNum">     296 </span>            : #define e2fs_cgload(old, new, size) e2fs_cg_bswap((old), (new), (size));
<span class="lineNum">     297 </span>            : #define e2fs_sbsave(old, new) e2fs_sb_bswap((old), (new))
<span class="lineNum">     298 </span>            : #define e2fs_cgsave(old, new, size) e2fs_cg_bswap((old), (new), (size));
<span class="lineNum">     299 </span>            : #endif
<span class="lineNum">     300 </span>            : 
<span class="lineNum">     301 </span>            : /*
<span class="lineNum">     302 </span>            :  * Turn file system block numbers into disk block addresses.
<span class="lineNum">     303 </span>            :  * This maps file system blocks to device size blocks.
<span class="lineNum">     304 </span>            :  */
<span class="lineNum">     305 </span>            : #define fsbtodb(fs, b)  ((b) &lt;&lt; (fs)-&gt;e2fs_fsbtodb)
<span class="lineNum">     306 </span>            : #define dbtofsb(fs, b)  ((b) &gt;&gt; (fs)-&gt;e2fs_fsbtodb)
<span class="lineNum">     307 </span>            : 
<span class="lineNum">     308 </span>            : /*
<span class="lineNum">     309 </span>            :  * Macros for handling inode numbers:
<span class="lineNum">     310 </span>            :  *       inode number to file system block offset.
<span class="lineNum">     311 </span>            :  *       inode number to cylinder group number.
<span class="lineNum">     312 </span>            :  *       inode number to file system block address.
<span class="lineNum">     313 </span>            :  */
<span class="lineNum">     314 </span>            : #define ino_to_cg(fs, x)        (((x) - 1) / (fs)-&gt;e2fs.e2fs_ipg)
<span class="lineNum">     315 </span>            : #define ino_to_fsba(fs, x)                                              \
<span class="lineNum">     316 </span>            :         ((fs)-&gt;e2fs_gd[ino_to_cg(fs, x)].ext2bgd_i_tables + \
<span class="lineNum">     317 </span>            :         (((x)-1) % (fs)-&gt;e2fs.e2fs_ipg)/(fs)-&gt;e2fs_ipb)
<span class="lineNum">     318 </span>            : #define ino_to_fsbo(fs, x)      (((x)-1) % (fs)-&gt;e2fs_ipb)
<span class="lineNum">     319 </span>            : 
<span class="lineNum">     320 </span>            : /*
<span class="lineNum">     321 </span>            :  * Give cylinder group number for a file system block.
<span class="lineNum">     322 </span>            :  * Give cylinder group block number for a file system block.
<span class="lineNum">     323 </span>            :  */
<span class="lineNum">     324 </span>            : #define dtog(fs, d) (((d) - (fs)-&gt;e2fs.e2fs_first_dblock) / (fs)-&gt;e2fs.e2fs_fpg)
<span class="lineNum">     325 </span>            : #define dtogd(fs, d) \
<span class="lineNum">     326 </span>            :         (((d) - (fs)-&gt;e2fs.e2fs_first_dblock) % (fs)-&gt;e2fs.e2fs_fpg)
<span class="lineNum">     327 </span>            : 
<span class="lineNum">     328 </span>            : /*
<span class="lineNum">     329 </span>            :  * The following macros optimize certain frequently calculated
<span class="lineNum">     330 </span>            :  * quantities by using shifts and masks in place of divisions
<span class="lineNum">     331 </span>            :  * modulos and multiplications.
<span class="lineNum">     332 </span>            :  */
<span class="lineNum">     333 </span>            : #define blkoff(fs, loc)         /* calculates (loc % fs-&gt;e2fs_bsize) */ \
<span class="lineNum">     334 </span>            :         ((loc) &amp; (fs)-&gt;e2fs_qbmask)
<span class="lineNum">     335 </span>            : #define lblktosize(fs, blk)     /* calculates (blk * fs-&gt;e2fs_bsize) */ \
<span class="lineNum">     336 </span>            :         ((blk) &lt;&lt; (fs)-&gt;e2fs_bshift)
<span class="lineNum">     337 </span>            : #define lblkno(fs, loc)         /* calculates (loc / fs-&gt;e2fs_bsize) */ \
<span class="lineNum">     338 </span>            :         ((loc) &gt;&gt; (fs)-&gt;e2fs_bshift)
<span class="lineNum">     339 </span>            : #define blkroundup(fs, size)    /* calculates roundup(size, fs-&gt;e2fs_bsize) */ \
<span class="lineNum">     340 </span>            :         (((size) + (fs)-&gt;e2fs_qbmask) &amp; (fs)-&gt;e2fs_bmask)
<span class="lineNum">     341 </span>            : #define fragroundup(fs, size)   /* calculates roundup(size, fs-&gt;e2fs_bsize) */ \
<span class="lineNum">     342 </span>            :         (((size) + (fs)-&gt;e2fs_qbmask) &amp; (fs)-&gt;e2fs_bmask)
<span class="lineNum">     343 </span>            : /*
<span class="lineNum">     344 </span>            :  * Determine the number of available frags given a
<span class="lineNum">     345 </span>            :  * percentage to hold in reserve.
<span class="lineNum">     346 </span>            :  */
<span class="lineNum">     347 </span>            : #define freespace(fs) \
<span class="lineNum">     348 </span>            :    ((fs)-&gt;e2fs.e2fs_fbcount - (fs)-&gt;e2fs.e2fs_rbcount)
<span class="lineNum">     349 </span>            : 
<span class="lineNum">     350 </span>            : /*
<span class="lineNum">     351 </span>            :  * Number of indirects in a file system block.
<span class="lineNum">     352 </span>            :  */
<span class="lineNum">     353 </span>            : #define NINDIR(fs)      ((fs)-&gt;e2fs_bsize / sizeof(u_int32_t))
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.13</a></td></tr>
  </table>
  <br>

</body>
</html>
