<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - 6.4 - dev/ic/aic7xxx_openbsd.h</title>
  <link rel="stylesheet" type="text/css" href="../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../index.html">top level</a> - <a href="index.html">dev/ic</a> - aic7xxx_openbsd.h<span style="font-size: 80%;"> (source / <a href="aic7xxx_openbsd.h.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">6.4</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">61</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2018-10-19 03:25:38</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">20</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Legend:</td>
            <td class="headerValueLeg">            Lines:
            <span class="coverLegendCov">hit</span>
            <span class="coverLegendNoCov">not hit</span>
</td>
            <td></td>
          </tr>
          <tr><td><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /*      $OpenBSD: aic7xxx_openbsd.h,v 1.27 2017/12/12 12:33:36 krw Exp $        */</a>
<span class="lineNum">       2 </span>            : /*      $NetBSD: aic7xxx_osm.h,v 1.7 2003/11/02 11:07:44 wiz Exp $      */
<span class="lineNum">       3 </span>            : 
<span class="lineNum">       4 </span>            : /*
<span class="lineNum">       5 </span>            :  * OpenBSD platform specific driver option settings, data structures,
<span class="lineNum">       6 </span>            :  * function declarations and includes.
<span class="lineNum">       7 </span>            :  *
<span class="lineNum">       8 </span>            :  * Copyright (c) 1994-2001 Justin T. Gibbs.
<span class="lineNum">       9 </span>            :  * Copyright (c) 2001-2002 Steve Murphree, Jr.
<span class="lineNum">      10 </span>            :  * All rights reserved.
<span class="lineNum">      11 </span>            :  *
<span class="lineNum">      12 </span>            :  * Redistribution and use in source and binary forms, with or without
<span class="lineNum">      13 </span>            :  * modification, are permitted provided that the following conditions
<span class="lineNum">      14 </span>            :  * are met:
<span class="lineNum">      15 </span>            :  * 1. Redistributions of source code must retain the above copyright
<span class="lineNum">      16 </span>            :  *    notice, this list of conditions, and the following disclaimer,
<span class="lineNum">      17 </span>            :  *    without modification.
<span class="lineNum">      18 </span>            :  * 2. The name of the author(s) may not be used to endorse or promote products
<span class="lineNum">      19 </span>            :  *    derived from this software without specific prior written permission.
<span class="lineNum">      20 </span>            :  *
<span class="lineNum">      21 </span>            :  * Alternatively, this software may be distributed under the terms of the
<span class="lineNum">      22 </span>            :  * GNU Public License (&quot;GPL&quot;).
<span class="lineNum">      23 </span>            :  *
<span class="lineNum">      24 </span>            :  * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND
<span class="lineNum">      25 </span>            :  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
<span class="lineNum">      26 </span>            :  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
<span class="lineNum">      27 </span>            :  * ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE FOR
<span class="lineNum">      28 </span>            :  * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
<span class="lineNum">      29 </span>            :  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
<span class="lineNum">      30 </span>            :  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
<span class="lineNum">      31 </span>            :  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
<span class="lineNum">      32 </span>            :  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
<span class="lineNum">      33 </span>            :  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
<span class="lineNum">      34 </span>            :  * SUCH DAMAGE.
<span class="lineNum">      35 </span>            :  *
<span class="lineNum">      36 </span>            :  * //depot/aic7xxx/freebsd/dev/aic7xxx/aic7xxx_osm.h#14 $
<span class="lineNum">      37 </span>            :  *
<span class="lineNum">      38 </span>            :  * $FreeBSD: /repoman/r/ncvs/src/sys/dev/aic7xxx/aic7xxx_osm.h,v 1.20 2002/12/04 22:51:29 scottl Exp $
<span class="lineNum">      39 </span>            :  */
<span class="lineNum">      40 </span>            : /*
<span class="lineNum">      41 </span>            :  * Ported from FreeBSD by Pascal Renauld, Network Storage Solutions, Inc. - April 2003
<span class="lineNum">      42 </span>            :  */
<span class="lineNum">      43 </span>            : 
<span class="lineNum">      44 </span>            : #ifndef _AIC7XXX_OPENBSD_H_
<span class="lineNum">      45 </span>            : #define _AIC7XXX_OPENBSD_H_
<span class="lineNum">      46 </span>            : 
<span class="lineNum">      47 </span>            : #include &quot;pci.h&quot;              /* for config options */
<span class="lineNum">      48 </span>            : 
<span class="lineNum">      49 </span>            : #include &lt;sys/param.h&gt;
<span class="lineNum">      50 </span>            : #include &lt;sys/kernel.h&gt;
<span class="lineNum">      51 </span>            : #include &lt;sys/systm.h&gt;
<span class="lineNum">      52 </span>            : #include &lt;sys/device.h&gt;
<span class="lineNum">      53 </span>            : #include &lt;sys/malloc.h&gt;
<span class="lineNum">      54 </span>            : #include &lt;sys/buf.h&gt;
<span class="lineNum">      55 </span>            : #include &lt;sys/queue.h&gt;
<span class="lineNum">      56 </span>            : 
<span class="lineNum">      57 </span>            : #include &lt;dev/pci/pcireg.h&gt;
<span class="lineNum">      58 </span>            : #include &lt;dev/pci/pcivar.h&gt;
<span class="lineNum">      59 </span>            : 
<span class="lineNum">      60 </span>            : #include &lt;machine/bus.h&gt;
<span class="lineNum">      61 </span>            : #include &lt;machine/intr.h&gt;
<span class="lineNum">      62 </span>            : 
<span class="lineNum">      63 </span>            : #include &lt;scsi/scsi_all.h&gt;
<span class="lineNum">      64 </span>            : #include &lt;scsi/scsi_message.h&gt;
<span class="lineNum">      65 </span>            : #include &lt;scsi/scsi_debug.h&gt;
<span class="lineNum">      66 </span>            : #include &lt;scsi/scsiconf.h&gt;
<span class="lineNum">      67 </span>            : 
<span class="lineNum">      68 </span>            : #include &lt;uvm/uvm_extern.h&gt;
<span class="lineNum">      69 </span>            : 
<span class="lineNum">      70 </span>            : #ifdef CAM_NEW_TRAN_CODE
<span class="lineNum">      71 </span>            : #define AHC_NEW_TRAN_SETTINGS
<span class="lineNum">      72 </span>            : #endif /* CAM_NEW_TRAN_CODE */
<span class="lineNum">      73 </span>            : 
<span class="lineNum">      74 </span>            : #if NPCI &gt; 0
<span class="lineNum">      75 </span>            : #define AHC_PCI_CONFIG 1
<span class="lineNum">      76 </span>            : #endif
<span class="lineNum">      77 </span>            : 
<span class="lineNum">      78 </span>            : #if 0
<span class="lineNum">      79 </span>            : #define AHC_DEBUG       AHC_SHOW_SENSE | AHC_SHOW_MISC | AHC_SHOW_CMDS
<span class="lineNum">      80 </span>            : #endif
<span class="lineNum">      81 </span>            : 
<span class="lineNum">      82 </span>            : #ifdef DEBUG
<span class="lineNum">      83 </span>            : #define bootverbose     1
<span class="lineNum">      84 </span>            : #else
<span class="lineNum">      85 </span>            : #define bootverbose     0
<span class="lineNum">      86 </span>            : #endif
<span class="lineNum">      87 </span>            : /****************************** Platform Macros *******************************/
<span class="lineNum">      88 </span>            : 
<span class="lineNum">      89 </span>            : #define SCSI_IS_SCSIBUS_B(ahc, sc_link) \
<span class="lineNum">      90 </span>            :         ((sc_link)-&gt;scsibus == (ahc)-&gt;sc_channel_b.scsibus)
<span class="lineNum">      91 </span>            : #define SCSI_SCSI_ID(ahc, sc_link)      \
<span class="lineNum">      92 </span>            :         (SCSI_IS_SCSIBUS_B(ahc, sc_link) ? ahc-&gt;our_id_b : ahc-&gt;our_id)
<span class="lineNum">      93 </span>            : #define SCSI_CHANNEL(ahc, sc_link)      \
<span class="lineNum">      94 </span>            :         (SCSI_IS_SCSIBUS_B(ahc, sc_link) ? 'B' : 'A')
<span class="lineNum">      95 </span>            : #define BUILD_SCSIID(ahc, sc_link, target_id, our_id) \
<span class="lineNum">      96 </span>            :         ((((target_id) &lt;&lt; TID_SHIFT) &amp; TID) | (our_id) \
<span class="lineNum">      97 </span>            :         | (SCSI_IS_SCSIBUS_B(ahc, sc_link) ? TWIN_CHNLB : 0))
<span class="lineNum">      98 </span>            : 
<span class="lineNum">      99 </span>            : #ifndef offsetof
<span class="lineNum">     100 </span>            : #define offsetof(type, member)  ((size_t)(&amp;((type *)0)-&gt;member))
<span class="lineNum">     101 </span>            : #endif
<span class="lineNum">     102 </span>            : /************************* Forward Declarations *******************************/
<span class="lineNum">     103 </span>            : typedef struct pci_attach_args * ahc_dev_softc_t;
<span class="lineNum">     104 </span>            : 
<span class="lineNum">     105 </span>            : /***************************** Bus Space/DMA **********************************/
<span class="lineNum">     106 </span>            : 
<span class="lineNum">     107 </span>            : /* XXX Need to update Bus DMA for partial map syncs */
<span class="lineNum">     108 </span>            : #define ahc_dmamap_sync(ahc, dma_tag, dmamap, offset, len, op)          \
<span class="lineNum">     109 </span>            :         bus_dmamap_sync(dma_tag, dmamap, offset, len, op)
<span class="lineNum">     110 </span>            : 
<span class="lineNum">     111 </span>            : /************************ Tunable Driver Parameters  **************************/
<span class="lineNum">     112 </span>            : /*
<span class="lineNum">     113 </span>            :  * The number of DMA segments supported.  The sequencer can handle any number
<span class="lineNum">     114 </span>            :  * of physically contiguous S/G entries.  To reduce the driver's memory
<span class="lineNum">     115 </span>            :  * consumption, we limit the number supported to be sufficient to handle
<span class="lineNum">     116 </span>            :  * the largest mapping supported by the kernel, MAXPHYS.  Assuming the
<span class="lineNum">     117 </span>            :  * transfer is as fragmented as possible and unaligned, this turns out to
<span class="lineNum">     118 </span>            :  * be the number of paged sized transfers in MAXPHYS plus an extra element
<span class="lineNum">     119 </span>            :  * to handle any unaligned residual.  The sequencer fetches SG elements
<span class="lineNum">     120 </span>            :  * in cacheline sized chucks, so make the number per-transaction an even
<span class="lineNum">     121 </span>            :  * multiple of 16 which should align us on even the largest of cacheline
<span class="lineNum">     122 </span>            :  * boundaries.
<span class="lineNum">     123 </span>            :  */
<span class="lineNum">     124 </span>            : #define AHC_NSEG (roundup(atop(MAXPHYS) + 1, 16))
<span class="lineNum">     125 </span>            : 
<span class="lineNum">     126 </span>            : /* This driver supports target mode */
<span class="lineNum">     127 </span>            : //#define AHC_TARGET_MODE 1
<span class="lineNum">     128 </span>            : 
<span class="lineNum">     129 </span>            : #include &lt;dev/ic/aic7xxxvar.h&gt;
<span class="lineNum">     130 </span>            : 
<span class="lineNum">     131 </span>            : /*
<span class="lineNum">     132 </span>            :  * Some ISA devices (e.g. on a VLB) can perform 32-bit DMA.  This
<span class="lineNum">     133 </span>            :  * flag is passed to bus_dmamap_create() to indicate that fact.
<span class="lineNum">     134 </span>            :  */
<span class="lineNum">     135 </span>            : #ifndef ISABUS_DMA_32BIT
<span class="lineNum">     136 </span>            : #define ISABUS_DMA_32BIT        BUS_DMA_BUS1
<span class="lineNum">     137 </span>            : #endif
<span class="lineNum">     138 </span>            : 
<span class="lineNum">     139 </span>            : /************************** Timer DataStructures ******************************/
<span class="lineNum">     140 </span>            : typedef struct timeout ahc_timer_t;
<span class="lineNum">     141 </span>            : 
<span class="lineNum">     142 </span>            : /***************************** Core Includes **********************************/
<span class="lineNum">     143 </span>            : #if AHC_REG_PRETTY_PRINT
<span class="lineNum">     144 </span>            : #define AIC_DEBUG_REGISTERS 1
<span class="lineNum">     145 </span>            : #else
<span class="lineNum">     146 </span>            : #define AIC_DEBUG_REGISTERS 0
<span class="lineNum">     147 </span>            : #endif
<span class="lineNum">     148 </span>            : 
<span class="lineNum">     149 </span>            : /***************************** Timer Facilities *******************************/
<span class="lineNum">     150 </span>            : void ahc_timeout(void*);
<span class="lineNum">     151 </span>            : 
<span class="lineNum">     152 </span>            : #define ahc_timer_init callout_init
<span class="lineNum">     153 </span>            : #define ahc_timer_stop callout_stop
<span class="lineNum">     154 </span>            : 
<span class="lineNum">     155 </span>            : static __inline void
<span class="lineNum">     156 </span>            : ahc_timer_reset(ahc_timer_t *timer, u_int usec, ahc_callback_t *func, void *arg)
<span class="lineNum">     157 </span>            : {
<span class="lineNum">     158 </span>            :         callout_reset(timer, (usec * hz)/1000000, func, arg);
<span class="lineNum">     159 </span>            : }
<a name="160"><span class="lineNum">     160 </span>            : </a>
<span class="lineNum">     161 </span>            : static __inline void
<span class="lineNum">     162 </span><span class="lineNoCov">          0 : ahc_scb_timer_reset(struct scb *scb, u_int usec)</span>
<span class="lineNum">     163 </span>            : {
<span class="lineNum">     164 </span><span class="lineNoCov">          0 :         if (!(scb-&gt;xs-&gt;xs_control &amp; XS_CTL_POLL)) {</span>
<span class="lineNum">     165 </span><span class="lineNoCov">          0 :                 callout_reset(&amp;scb-&gt;xs-&gt;xs_callout,</span>
<span class="lineNum">     166 </span>            :                               (usec * hz)/1000000, ahc_timeout, scb);
<span class="lineNum">     167 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     168 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     169 </span>            : 
<span class="lineNum">     170 </span>            : /*************************** Device Access ************************************/
<span class="lineNum">     171 </span>            : #define ahc_inb(ahc, port)                              \
<span class="lineNum">     172 </span>            :         bus_space_read_1((ahc)-&gt;tag, (ahc)-&gt;bsh, port)
<span class="lineNum">     173 </span>            : 
<span class="lineNum">     174 </span>            : #define ahc_outb(ahc, port, value)                      \
<span class="lineNum">     175 </span>            :         bus_space_write_1((ahc)-&gt;tag, (ahc)-&gt;bsh, port, value)
<span class="lineNum">     176 </span>            : 
<span class="lineNum">     177 </span>            : #define ahc_outsb(ahc, port, valp, count)               \
<span class="lineNum">     178 </span>            :         bus_space_write_multi_1((ahc)-&gt;tag, (ahc)-&gt;bsh, port, valp, count)
<span class="lineNum">     179 </span>            : 
<span class="lineNum">     180 </span>            : #define ahc_insb(ahc, port, valp, count)                \
<span class="lineNum">     181 </span>            :         bus_space_read_multi_1((ahc)-&gt;tag, (ahc)-&gt;bsh, port, valp, count)
<span class="lineNum">     182 </span>            : 
<span class="lineNum">     183 </span>            : static __inline void ahc_flush_device_writes(struct ahc_softc *);
<a name="184"><span class="lineNum">     184 </span>            : </a>
<span class="lineNum">     185 </span>            : static __inline void
<span class="lineNum">     186 </span><span class="lineNoCov">          0 : ahc_flush_device_writes(struct ahc_softc *ahc)</span>
<span class="lineNum">     187 </span>            : {
<span class="lineNum">     188 </span><span class="lineNoCov">          0 :         bus_space_barrier(ahc-&gt;tag, ahc-&gt;bsh, 0, 0x100,</span>
<span class="lineNum">     189 </span>            :             BUS_SPACE_BARRIER_READ | BUS_SPACE_BARRIER_WRITE);
<span class="lineNum">     190 </span><span class="lineNoCov">          0 :         ahc_inb(ahc, INTSTAT);</span>
<span class="lineNum">     191 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     192 </span>            : 
<span class="lineNum">     193 </span>            : /**************************** Locking Primitives ******************************/
<span class="lineNum">     194 </span>            : 
<span class="lineNum">     195 </span>            : /****************************** OS Primitives *********************************/
<span class="lineNum">     196 </span>            : 
<span class="lineNum">     197 </span>            : /************************** Transaction Operations ****************************/
<span class="lineNum">     198 </span>            : static __inline void ahc_set_transaction_status(struct scb *, uint32_t);
<span class="lineNum">     199 </span>            : static __inline void ahc_set_scsi_status(struct scb *, uint32_t);
<span class="lineNum">     200 </span>            : static __inline uint32_t ahc_get_transaction_status(struct scb *);
<span class="lineNum">     201 </span>            : static __inline uint32_t ahc_get_scsi_status(struct scb *);
<span class="lineNum">     202 </span>            : static __inline void ahc_set_transaction_tag(struct scb *, int, u_int);
<span class="lineNum">     203 </span>            : static __inline u_long ahc_get_transfer_length(struct scb *);
<span class="lineNum">     204 </span>            : static __inline int ahc_get_transfer_dir(struct scb *);
<span class="lineNum">     205 </span>            : static __inline void ahc_set_residual(struct scb *, u_long);
<span class="lineNum">     206 </span>            : static __inline void ahc_set_sense_residual(struct scb *, u_long);
<span class="lineNum">     207 </span>            : static __inline u_long ahc_get_residual(struct scb *);
<span class="lineNum">     208 </span>            : static __inline int ahc_perform_autosense(struct scb *);
<span class="lineNum">     209 </span>            : static __inline uint32_t ahc_get_sense_bufsize(struct ahc_softc *,
<span class="lineNum">     210 </span>            :     struct scb *);
<span class="lineNum">     211 </span>            : static __inline void ahc_freeze_scb(struct scb *);
<a name="212"><span class="lineNum">     212 </span>            : </a>
<span class="lineNum">     213 </span>            : static __inline
<span class="lineNum">     214 </span><span class="lineNoCov">          0 : void ahc_set_transaction_status(struct scb *scb, uint32_t status)</span>
<span class="lineNum">     215 </span>            : {
<span class="lineNum">     216 </span><span class="lineNoCov">          0 :         scb-&gt;xs-&gt;error = status;</span>
<span class="lineNum">     217 </span><span class="lineNoCov">          0 : }</span>
<a name="218"><span class="lineNum">     218 </span>            : </a>
<span class="lineNum">     219 </span>            : static __inline
<span class="lineNum">     220 </span><span class="lineNoCov">          0 : void ahc_set_scsi_status(struct scb *scb, uint32_t status)</span>
<span class="lineNum">     221 </span>            : {
<span class="lineNum">     222 </span><span class="lineNoCov">          0 :         scb-&gt;xs-&gt;status = status;</span>
<span class="lineNum">     223 </span><span class="lineNoCov">          0 : }</span>
<a name="224"><span class="lineNum">     224 </span>            : </a>
<span class="lineNum">     225 </span>            : static __inline
<span class="lineNum">     226 </span><span class="lineNoCov">          0 : uint32_t ahc_get_transaction_status(struct scb *scb)</span>
<span class="lineNum">     227 </span>            : {
<span class="lineNum">     228 </span><span class="lineNoCov">          0 :         if (scb-&gt;xs-&gt;flags &amp; ITSDONE)</span>
<span class="lineNum">     229 </span><span class="lineNoCov">          0 :                 return CAM_REQ_CMP;</span>
<span class="lineNum">     230 </span>            :         else
<span class="lineNum">     231 </span><span class="lineNoCov">          0 :                 return scb-&gt;xs-&gt;error;</span>
<span class="lineNum">     232 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     233 </span>            : 
<span class="lineNum">     234 </span>            : static __inline
<span class="lineNum">     235 </span>            : uint32_t ahc_get_scsi_status(struct scb *scb)
<span class="lineNum">     236 </span>            : {
<span class="lineNum">     237 </span>            :         return (scb-&gt;xs-&gt;status);
<span class="lineNum">     238 </span>            : }
<a name="239"><span class="lineNum">     239 </span>            : </a>
<span class="lineNum">     240 </span>            : static __inline
<span class="lineNum">     241 </span><span class="lineNoCov">          0 : void ahc_set_transaction_tag(struct scb *scb, int enabled, u_int type)</span>
<span class="lineNum">     242 </span>            : {
<span class="lineNum">     243 </span><span class="lineNoCov">          0 : }</span>
<a name="244"><span class="lineNum">     244 </span>            : </a>
<span class="lineNum">     245 </span>            : static __inline
<span class="lineNum">     246 </span><span class="lineNoCov">          0 : u_long ahc_get_transfer_length(struct scb *scb)</span>
<span class="lineNum">     247 </span>            : {
<span class="lineNum">     248 </span><span class="lineNoCov">          0 :         return (scb-&gt;xs-&gt;datalen);</span>
<span class="lineNum">     249 </span>            : }
<a name="250"><span class="lineNum">     250 </span>            : </a>
<span class="lineNum">     251 </span>            : static __inline
<span class="lineNum">     252 </span><span class="lineNoCov">          0 : int ahc_get_transfer_dir(struct scb *scb)</span>
<span class="lineNum">     253 </span>            : {
<span class="lineNum">     254 </span><span class="lineNoCov">          0 :         return (scb-&gt;xs-&gt;flags &amp; (SCSI_DATA_IN | SCSI_DATA_OUT));</span>
<span class="lineNum">     255 </span>            : }
<a name="256"><span class="lineNum">     256 </span>            : </a>
<span class="lineNum">     257 </span>            : static __inline
<span class="lineNum">     258 </span><span class="lineNoCov">          0 : void ahc_set_residual(struct scb *scb, u_long resid)</span>
<span class="lineNum">     259 </span>            : {
<span class="lineNum">     260 </span><span class="lineNoCov">          0 :         scb-&gt;xs-&gt;resid = resid;</span>
<span class="lineNum">     261 </span><span class="lineNoCov">          0 : }</span>
<a name="262"><span class="lineNum">     262 </span>            : </a>
<span class="lineNum">     263 </span>            : static __inline
<span class="lineNum">     264 </span><span class="lineNoCov">          0 : void ahc_set_sense_residual(struct scb *scb, u_long resid)</span>
<span class="lineNum">     265 </span>            : {
<span class="lineNum">     266 </span><span class="lineNoCov">          0 :         scb-&gt;xs-&gt;resid = resid;</span>
<span class="lineNum">     267 </span><span class="lineNoCov">          0 : }</span>
<a name="268"><span class="lineNum">     268 </span>            : </a>
<span class="lineNum">     269 </span>            : static __inline
<span class="lineNum">     270 </span><span class="lineNoCov">          0 : u_long ahc_get_residual(struct scb *scb)</span>
<span class="lineNum">     271 </span>            : {
<span class="lineNum">     272 </span><span class="lineNoCov">          0 :         return (scb-&gt;xs-&gt;resid);</span>
<span class="lineNum">     273 </span>            : }
<a name="274"><span class="lineNum">     274 </span>            : </a>
<span class="lineNum">     275 </span>            : static __inline
<span class="lineNum">     276 </span><span class="lineNoCov">          0 : int ahc_perform_autosense(struct scb *scb)</span>
<span class="lineNum">     277 </span>            : {
<span class="lineNum">     278 </span>            :         /* Return true for OpenBSD */
<span class="lineNum">     279 </span><span class="lineNoCov">          0 :         return (1);</span>
<span class="lineNum">     280 </span>            : }
<a name="281"><span class="lineNum">     281 </span>            : </a>
<span class="lineNum">     282 </span>            : static __inline uint32_t
<span class="lineNum">     283 </span><span class="lineNoCov">          0 : ahc_get_sense_bufsize(struct ahc_softc *ahc, struct scb *scb)</span>
<span class="lineNum">     284 </span>            : {
<span class="lineNum">     285 </span><span class="lineNoCov">          0 :         return (sizeof(struct scsi_sense_data));</span>
<span class="lineNum">     286 </span>            : }
<a name="287"><span class="lineNum">     287 </span>            : </a>
<span class="lineNum">     288 </span>            : static __inline void
<span class="lineNum">     289 </span><span class="lineNoCov">          0 : ahc_freeze_scb(struct scb *scb)</span>
<span class="lineNum">     290 </span>            : {
<span class="lineNum">     291 </span><span class="lineNoCov">          0 : }</span>
<a name="292"><span class="lineNum">     292 </span>            : </a>
<span class="lineNum">     293 </span>            : static __inline void
<span class="lineNum">     294 </span><span class="lineNoCov">          0 : ahc_platform_scb_free(struct ahc_softc *ahc, struct scb *scb)</span>
<span class="lineNum">     295 </span>            : {
<span class="lineNum">     296 </span>            :         int s;
<span class="lineNum">     297 </span>            : 
<span class="lineNum">     298 </span><span class="lineNoCov">          0 :         s = splbio();</span>
<span class="lineNum">     299 </span>            : 
<span class="lineNum">     300 </span><span class="lineNoCov">          0 :         if ((ahc-&gt;flags &amp; AHC_RESOURCE_SHORTAGE) != 0) {</span>
<span class="lineNum">     301 </span><span class="lineNoCov">          0 :                 ahc-&gt;flags &amp;= ~AHC_RESOURCE_SHORTAGE;</span>
<span class="lineNum">     302 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     303 </span>            : 
<span class="lineNum">     304 </span><span class="lineNoCov">          0 :         timeout_del(&amp;scb-&gt;xs-&gt;stimeout);</span>
<span class="lineNum">     305 </span>            : 
<span class="lineNum">     306 </span><span class="lineNoCov">          0 :         splx(s);</span>
<span class="lineNum">     307 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     308 </span>            : 
<span class="lineNum">     309 </span>            : /********************************** PCI ***************************************/
<span class="lineNum">     310 </span>            : #ifdef AHC_PCI_CONFIG
<span class="lineNum">     311 </span>            : static __inline uint32_t ahc_pci_read_config(ahc_dev_softc_t, int, int);
<span class="lineNum">     312 </span>            : static __inline void     ahc_pci_write_config(ahc_dev_softc_t, int, uint32_t,
<span class="lineNum">     313 </span>            :     int);
<span class="lineNum">     314 </span>            : static __inline int      ahc_get_pci_function(ahc_dev_softc_t);
<span class="lineNum">     315 </span>            : static __inline int      ahc_get_pci_slot(ahc_dev_softc_t);
<span class="lineNum">     316 </span>            : static __inline int      ahc_get_pci_bus(ahc_dev_softc_t);
<span class="lineNum">     317 </span>            : 
<span class="lineNum">     318 </span>            : int                      ahc_pci_map_registers(struct ahc_softc *);
<span class="lineNum">     319 </span>            : int                      ahc_pci_map_int(struct ahc_softc *);
<span class="lineNum">     320 </span>            : 
<span class="lineNum">     321 </span>            : static __inline uint32_t
<span class="lineNum">     322 </span>            : ahc_pci_read_config(ahc_dev_softc_t pci, int reg, int width)
<span class="lineNum">     323 </span>            : {
<span class="lineNum">     324 </span>            :         return (pci_conf_read(pci-&gt;pa_pc, pci-&gt;pa_tag, reg));
<span class="lineNum">     325 </span>            : }
<span class="lineNum">     326 </span>            : 
<span class="lineNum">     327 </span>            : static __inline void
<span class="lineNum">     328 </span>            : ahc_pci_write_config(ahc_dev_softc_t pci, int reg, uint32_t value, int width)
<span class="lineNum">     329 </span>            : {
<span class="lineNum">     330 </span>            :         pci_conf_write(pci-&gt;pa_pc, pci-&gt;pa_tag, reg, value);
<span class="lineNum">     331 </span>            : }
<a name="332"><span class="lineNum">     332 </span>            : </a>
<span class="lineNum">     333 </span>            : static __inline int
<span class="lineNum">     334 </span><span class="lineNoCov">          0 : ahc_get_pci_function(ahc_dev_softc_t pci)</span>
<span class="lineNum">     335 </span>            : {
<span class="lineNum">     336 </span><span class="lineNoCov">          0 :         return (pci-&gt;pa_function);</span>
<span class="lineNum">     337 </span>            : }
<a name="338"><span class="lineNum">     338 </span>            : </a>
<span class="lineNum">     339 </span>            : static __inline int
<span class="lineNum">     340 </span><span class="lineNoCov">          0 : ahc_get_pci_slot(ahc_dev_softc_t pci)</span>
<span class="lineNum">     341 </span>            : {
<span class="lineNum">     342 </span><span class="lineNoCov">          0 :         return (pci-&gt;pa_device);</span>
<span class="lineNum">     343 </span>            : }
<a name="344"><span class="lineNum">     344 </span>            : </a>
<span class="lineNum">     345 </span>            : static __inline int
<span class="lineNum">     346 </span><span class="lineNoCov">          0 : ahc_get_pci_bus(ahc_dev_softc_t pci)</span>
<span class="lineNum">     347 </span>            : {
<span class="lineNum">     348 </span><span class="lineNoCov">          0 :         return (pci-&gt;pa_bus);</span>
<span class="lineNum">     349 </span>            : }
<span class="lineNum">     350 </span>            : 
<span class="lineNum">     351 </span>            : typedef enum
<span class="lineNum">     352 </span>            : {
<span class="lineNum">     353 </span>            :         AHC_POWER_STATE_D0,
<span class="lineNum">     354 </span>            :         AHC_POWER_STATE_D1,
<span class="lineNum">     355 </span>            :         AHC_POWER_STATE_D2,
<span class="lineNum">     356 </span>            :         AHC_POWER_STATE_D3
<span class="lineNum">     357 </span>            : } ahc_power_state;
<span class="lineNum">     358 </span>            : 
<span class="lineNum">     359 </span>            : void ahc_power_state_change(struct ahc_softc *, ahc_power_state);
<span class="lineNum">     360 </span>            : #endif
<span class="lineNum">     361 </span>            : /******************************** VL/EISA *************************************/
<span class="lineNum">     362 </span>            : int aic7770_map_registers(struct ahc_softc *, u_int);
<span class="lineNum">     363 </span>            : int aic7770_map_int(struct ahc_softc *, int);
<span class="lineNum">     364 </span>            : 
<span class="lineNum">     365 </span>            : /********************************* Debug **************************************/
<span class="lineNum">     366 </span>            : static __inline void    ahc_print_path(struct ahc_softc *, struct scb *);
<span class="lineNum">     367 </span>            : static __inline void    ahc_platform_dump_card_state(struct ahc_softc *);
<a name="368"><span class="lineNum">     368 </span>            : </a>
<span class="lineNum">     369 </span>            : static __inline void
<span class="lineNum">     370 </span><span class="lineNoCov">          0 : ahc_print_path(struct ahc_softc *ahc, struct scb *scb)</span>
<span class="lineNum">     371 </span>            : {
<span class="lineNum">     372 </span><span class="lineNoCov">          0 :         sc_print_addr(scb-&gt;xs-&gt;sc_link);</span>
<span class="lineNum">     373 </span><span class="lineNoCov">          0 : }</span>
<a name="374"><span class="lineNum">     374 </span>            : </a>
<span class="lineNum">     375 </span>            : static __inline void
<span class="lineNum">     376 </span><span class="lineNoCov">          0 : ahc_platform_dump_card_state(struct ahc_softc *ahc)</span>
<span class="lineNum">     377 </span>            : {
<span class="lineNum">     378 </span>            :         /* Nothing to do here for OpenBSD */
<span class="lineNum">     379 </span><span class="lineNoCov">          0 :         printf(&quot;FEATURES = 0x%x, FLAGS = 0x%x, CHIP = 0x%x BUGS =0x%x\n&quot;,</span>
<span class="lineNum">     380 </span><span class="lineNoCov">          0 :                ahc-&gt;features, ahc-&gt;flags, ahc-&gt;chip, ahc-&gt;bugs);</span>
<span class="lineNum">     381 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     382 </span>            : /**************************** Transfer Settings *******************************/
<span class="lineNum">     383 </span>            : void      ahc_notify_xfer_settings_change(struct ahc_softc *,
<span class="lineNum">     384 </span>            :                                           struct ahc_devinfo *);
<span class="lineNum">     385 </span>            : void      ahc_platform_set_tags(struct ahc_softc *, struct ahc_devinfo *, int);
<span class="lineNum">     386 </span>            : 
<span class="lineNum">     387 </span>            : /************************* Initialization/Teardown ****************************/
<span class="lineNum">     388 </span>            : int       ahc_map_int(struct ahc_softc *);
<span class="lineNum">     389 </span>            : int       ahc_attach(struct ahc_softc *);
<span class="lineNum">     390 </span>            : int       ahc_softc_comp(struct ahc_softc *, struct ahc_softc *);
<span class="lineNum">     391 </span>            : int       ahc_detach(struct device *, int);
<span class="lineNum">     392 </span>            : 
<span class="lineNum">     393 </span>            : /****************************** Interrupts ************************************/
<span class="lineNum">     394 </span>            : int                     ahc_platform_intr(void *);
<span class="lineNum">     395 </span>            : 
<span class="lineNum">     396 </span>            : /************************ Misc Function Declarations **************************/
<span class="lineNum">     397 </span>            : void      ahc_done(struct ahc_softc *, struct scb *);
<span class="lineNum">     398 </span>            : void      ahc_send_async(struct ahc_softc *, char, u_int, u_int, ac_code,
<span class="lineNum">     399 </span>            :     void *);
<span class="lineNum">     400 </span>            : void     *ahc_scb_alloc(void *);
<span class="lineNum">     401 </span>            : void      ahc_scb_free(void *, void *);
<span class="lineNum">     402 </span>            : 
<span class="lineNum">     403 </span>            : #endif  /* _AIC7XXX_OPENBSD_H_ */
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.13</a></td></tr>
  </table>
  <br>

</body>
</html>
